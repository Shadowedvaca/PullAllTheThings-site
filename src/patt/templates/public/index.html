{% extends "base.html" %}
{% block title %}Pull All The Things â€” WoW Guild{% endblock %}

{% block head %}
<link rel="stylesheet" href="/static/css/landing.css">
{% endblock %}

{% block content %}

{# â”€â”€ Hero â”€â”€ #}
<section class="lp-hero">
    <h1 class="lp-hero__title">Pull All The Things</h1>
    <p class="lp-hero__tagline">Casual Heroic Raiding with Real-Life Balance &amp; Immaculate Vibes</p>
    <div class="lp-faction-badges">
        <span class="lp-badge lp-badge--horde">ğŸ”¥ Horde</span>
        <span class="lp-badge">âš”ï¸ Alliance</span>
        <span class="lp-badge lp-badge--gold">ğŸ° Est. BC</span>
    </div>
    <p class="lp-realm-info">Based on Sen'jin &bull; Cross-Realm Welcome</p>
</section>

<div class="lp-container">

{# â”€â”€ Active Campaigns â”€â”€ #}
{% if live_campaigns %}
<section class="lp-campaigns-section">
    <h2 class="lp-section-title">ğŸ—³ Active Votes</h2>
    <div class="campaign-cards">
        {% for c in live_campaigns %}
        <div class="campaign-card">
            <div class="campaign-card__title">{{ c.title }}</div>
            {% if c.description %}
                <div class="campaign-card__meta">{{ c.description[:100] }}{% if c.description|length > 100 %}â€¦{% endif %}</div>
            {% endif %}
            <div class="campaign-card__meta">
                {% if c.entries %}{{ c.entries|length }} entries{% endif %}
                &bull; Ends in
                <span class="countdown" data-end-ts="{{ (c.start_at.timestamp() + c.duration_hours * 3600)|int }}">â€¦</span>
            </div>
            <div class="campaign-card__actions">
                {% if current_member %}
                    <a href="/vote/{{ c.id }}" class="btn btn-primary btn-sm">Vote Now</a>
                {% else %}
                    <a href="/login?next=/vote/{{ c.id }}" class="btn btn-secondary btn-sm">Login to Vote</a>
                {% endif %}
            </div>
        </div>
        {% endfor %}
    </div>
</section>
{% endif %}

{# â”€â”€ Recent Results â”€â”€ #}
{% if closed_campaigns %}
<section class="lp-campaigns-section">
    <h2 class="lp-section-title">Recent Results</h2>
    <div class="campaign-cards">
        {% for c in closed_campaigns %}
        <div class="campaign-card">
            <div class="campaign-card__title">{{ c.title }}</div>
            <div class="campaign-card__meta"><span class="badge badge-closed">Closed</span></div>
            <div class="campaign-card__actions">
                <a href="/vote/{{ c.id }}" class="btn btn-secondary btn-sm">View Results</a>
            </div>
        </div>
        {% endfor %}
    </div>
</section>
{% endif %}

{% if live_campaigns or closed_campaigns %}
<hr class="lp-divider">
{% endif %}

{# â”€â”€ Who We Are â”€â”€ #}
<section class="lp-section">
    <h2 class="lp-section-title">Who We Are</h2>
    <div class="lp-about">
        <p>
            <span class="lp-highlight">Tired of pug chaos?</span> Want a guild that values progression
            <em>and</em> your IRL commitments? Come pull all the things with us.
        </p>
        <p>
            Pull All The Things is a tight-knit guild run by adult gamers who log in to make progress
            and most importantly enjoy downtime. We raid Heroic content weekly, push Mythic+ keys,
            go on mount runs, knock out achievements, and chill in Discord with all of the memes.
        </p>
        <p>
            But honestly? <span class="lp-highlight">We care more about people who mesh with our group than class/spec.</span>
        </p>
        <div class="lp-values">
            <div class="lp-value"><span class="lp-value__icon">ğŸ </span><span><strong>Real-Life First</strong> â€” Life happens, we get it</span></div>
            <div class="lp-value"><span class="lp-value__icon">ğŸ¤</span><span><strong>Inclusive</strong> â€” Any role, any skill level</span></div>
            <div class="lp-value"><span class="lp-value__icon">ğŸ’š</span><span><strong>Community</strong> â€” M+, crafting, achievements</span></div>
            <div class="lp-value"><span class="lp-value__icon">âœ¨</span><span><strong>Zero Toxicity</strong> â€” Good vibes only</span></div>
        </div>
    </div>
</section>

{# â”€â”€ Currently Recruiting â”€â”€ #}
<section class="lp-section">
    <h2 class="lp-section-title">Currently Recruiting</h2>
    <div class="lp-needs">
        <div class="lp-needs-grid">
            <div class="lp-need-item" id="need-tank">
                <div class="lp-need-role role-tank">ğŸ›¡ï¸ Tank</div>
                <div class="lp-need-count" id="need-tank-count">Loadingâ€¦</div>
            </div>
            <div class="lp-need-item" id="need-healer">
                <div class="lp-need-role role-healer">ğŸ’š Healer</div>
                <div class="lp-need-count" id="need-healer-count">Loadingâ€¦</div>
            </div>
            <div class="lp-need-item" id="need-melee">
                <div class="lp-need-role role-dps">âš”ï¸ Melee DPS</div>
                <div class="lp-need-count" id="need-melee-count">Loadingâ€¦</div>
            </div>
            <div class="lp-need-item" id="need-ranged">
                <div class="lp-need-role role-dps">ğŸ¹ Ranged DPS</div>
                <div class="lp-need-count" id="need-ranged-count">Loadingâ€¦</div>
            </div>
        </div>
        <p class="lp-needs-note" id="needsNote">Targeting 20-player roster</p>
    </div>
</section>

{# â”€â”€ Weekly Schedule â”€â”€ #}
<section class="lp-section">
    <h2 class="lp-section-title">Weekly Schedule</h2>
    <div class="lp-schedule">
        <div class="lp-sched-item">
            <div class="lp-sched-day">Friday</div>
            <div class="lp-sched-time">6:00 PM PST / 9:00 PM EST</div>
            <div class="lp-sched-desc">Heroic Raid Night</div>
        </div>
        <div class="lp-sched-item">
            <div class="lp-sched-day">Saturday</div>
            <div class="lp-sched-time">6:00 PM PST / 9:00 PM EST</div>
            <div class="lp-sched-desc">Heroic Raid Night</div>
        </div>
        <div class="lp-sched-item">
            <div class="lp-sched-day">Sunday</div>
            <div class="lp-sched-time">Flexible</div>
            <div class="lp-sched-desc">Achievement Runs</div>
        </div>
        <div class="lp-sched-item">
            <div class="lp-sched-day">Weeknights</div>
            <div class="lp-sched-time">Various</div>
            <div class="lp-sched-desc">Mythic+ / Delves / PvP</div>
        </div>
    </div>
</section>

{# â”€â”€ Join Us â”€â”€ #}
<section class="lp-section">
    <h2 class="lp-section-title">Join Us</h2>
    <div class="lp-links">
        <a href="https://discord.gg/jgSSRBvjHM" target="_blank" rel="noopener" class="lp-link-card">
            <span class="lp-link-icon">ğŸ’¬</span>
            <span class="lp-link-title">Discord</span>
            <span class="lp-link-desc">Hop in, grab a guest role, and say hi!</span>
        </a>
        <a href="https://us.forums.blizzard.com/en/wow/t/ah-pull-all-the-things-recruiting-casual-heroic-raiding-with-real-life-balance-immaculate-vibes/2060891" target="_blank" rel="noopener" class="lp-link-card">
            <span class="lp-link-icon">ğŸ“œ</span>
            <span class="lp-link-title">Forum Post</span>
            <span class="lp-link-desc">Our official recruitment thread</span>
        </a>
    </div>
</section>

{# â”€â”€ Guild Officers â”€â”€ #}
<section class="lp-section">
    <h2 class="lp-section-title">Guild Officers</h2>
    <div class="lp-gl-card">
        <div class="lp-gl-avatar">ğŸ‘‘</div>
        <div>
            <div class="lp-gl-rank">Guild Leader</div>
            <div class="lp-gl-name">Trog</div>
            <div class="lp-gl-char">
                <a href="https://worldofwarcraft.blizzard.com/en-us/character/us/senjin/trogmoon" target="_blank" rel="noopener" class="role-dps">
                    Trogmoon â€” Balance Druid
                </a>
            </div>
        </div>
    </div>
    <div class="lp-officers">
        <div class="lp-officer-card">
            <div class="lp-officer-avatar">ğŸ›¡ï¸</div>
            <div>
                <div class="lp-officer-name">Shodoom</div>
                <div class="lp-officer-char">
                    <a href="https://worldofwarcraft.blizzard.com/en-us/character/us/bleeding-hollow/shodoom" target="_blank" rel="noopener" class="role-tank">
                        Shodoom â€” Prot Paladin
                    </a>
                </div>
            </div>
        </div>
        <div class="lp-officer-card">
            <div class="lp-officer-avatar">ğŸ’š</div>
            <div>
                <div class="lp-officer-name">Mito</div>
                <div class="lp-officer-char">
                    <a href="https://worldofwarcraft.blizzard.com/en-us/character/us/alterac-mountains/bloodvalor" target="_blank" rel="noopener" class="role-healer">
                        Bloodvalor â€” Holy Paladin
                    </a>
                </div>
            </div>
        </div>
        <div class="lp-officer-card">
            <div class="lp-officer-avatar">âš”ï¸</div>
            <div>
                <div class="lp-officer-name">Rocket</div>
                <div class="lp-officer-char">
                    <a href="https://worldofwarcraft.blizzard.com/en-us/character/us/sargeras/Zatan%C3%B1a" target="_blank" rel="noopener" class="role-dps">
                        ZataÃ±Ã±a â€” Demo Warlock
                    </a>
                </div>
            </div>
        </div>
        <div class="lp-officer-card">
            <div class="lp-officer-avatar">âš”ï¸</div>
            <div>
                <div class="lp-officer-name">Skate</div>
                <div class="lp-officer-char">
                    <a href="https://worldofwarcraft.blizzard.com/en-us/character/us/tichondrius/skatefarm" target="_blank" rel="noopener" class="role-dps">
                        Skatefarm â€” Feral Druid
                    </a>
                </div>
            </div>
        </div>
    </div>
</section>

{# â”€â”€ Mito's Quote of the Day â”€â”€ #}
<section class="lp-section">
    <h2 class="lp-section-title">Mito's Quote of the Day</h2>
    <div class="lp-quote">
        <div class="lp-quote-char">
            <div class="lp-quote-avatar">ğŸ’š</div>
            <div class="lp-quote-name">Mito</div>
        </div>
        <div class="lp-quote-bubble">
            <div class="lp-quote-text">
                {{ mito_quote or "Anything is possible when your character raids like a Paladin. I'm on a charger." }}
            </div>
            <div class="lp-quote-label">â€” Mito, {{ mito_title or "Healer Extraordinaire" }}</div>
        </div>
    </div>
</section>

{# â”€â”€ Members Only â”€â”€ #}
<section class="lp-section">
    <h2 class="lp-section-title">ğŸ”’ Members Only</h2>
    <div class="lp-members">
        <p class="lp-members-note">Guild tools for PATT members. If you're not in the guild yet, hop into Discord first!</p>
        <div class="lp-links">
            <a href="/roster.html" class="lp-link-card">
                <span class="lp-link-icon">ğŸ“</span>
                <span class="lp-link-title">Join Roster</span>
                <span class="lp-link-desc">Sign up for the raid roster</span>
            </a>
            <a href="/roster-view.html" class="lp-link-card">
                <span class="lp-link-icon">ğŸ‘¥</span>
                <span class="lp-link-title">View Roster</span>
                <span class="lp-link-desc">See who's on the team</span>
            </a>
        </div>
    </div>
</section>

</div>{# /lp-container #}
{% endblock %}

{% block scripts %}
<script src="/static/js/countdown.js"></script>
<script>
// â”€â”€ Recruiting Needs (live from platform API) â”€â”€
const RAID_TARGETS = { tank: 2, healer: 4, melee: 7, ranged: 7 };
const TANK_SPECS   = ['Protection', 'Guardian', 'Brewmaster', 'Blood', 'Vengeance'];
const HEALER_SPECS = ['Holy', 'Discipline', 'Restoration', 'Mistweaver', 'Preservation'];
const MELEE_SPECS  = [
    'Fury', 'Arms',
    'Retribution',
    'Feral', 'Guardian',
    'Windwalker', 'Brewmaster',
    'Assassination', 'Outlaw', 'Subtlety',
    'Enhancement',
    'Unholy', 'Frost', 'Blood',
    'Havoc', 'Vengeance',
    'Survival'
];

async function loadRecruitingNeeds() {
    try {
        const res = await fetch('/api/v1/guild/roster-data');
        const data = await res.json();
        if (!data.success || !data.characters) { showDefaultNeeds(); return; }

        const counts = { tank: 0, healer: 0, melee: 0, ranged: 0 };
        data.characters.forEach(char => {
            const isMain = char.mainAlt === 'Main';
            if (!isMain) return;
            const spec = char.spec || '';
            const role = (char.role || '').toLowerCase();
            if (role === 'tank' || TANK_SPECS.includes(spec))         counts.tank++;
            else if (role === 'healer' || HEALER_SPECS.includes(spec)) counts.healer++;
            else if (role === 'melee' || MELEE_SPECS.includes(spec))   counts.melee++;
            else                                                         counts.ranged++;
        });

        const total = Object.values(counts).reduce((a, b) => a + b, 0);
        ['tank', 'healer', 'melee', 'ranged'].forEach(role => {
            const target  = RAID_TARGETS[role];
            const current = counts[role];
            const needed  = Math.max(0, target - current);
            const countEl = document.getElementById(`need-${role}-count`);
            const itemEl  = document.getElementById(`need-${role}`);
            if (!countEl) return;
            if (needed === 0) {
                countEl.textContent = `âœ“ Full (${current}/${target})`;
                itemEl && itemEl.classList.add('fulfilled');
            } else {
                countEl.textContent = `${needed} needed (${current}/${target})`;
                itemEl && itemEl.classList.remove('fulfilled');
                if (needed >= 3 && itemEl) itemEl.classList.add('high-need');
            }
        });
        const noteEl = document.getElementById('needsNote');
        if (needsNote) noteEl.textContent = `Current roster: ${total}/20 â€¢ Updated live`;
    } catch (e) {
        showDefaultNeeds();
    }
}

function showDefaultNeeds() {
    const defaults = { tank: '1 needed', healer: '1â€“2 needed', melee: '3â€“4 needed', ranged: '3â€“4 needed' };
    Object.entries(defaults).forEach(([role, text]) => {
        const el = document.getElementById(`need-${role}-count`);
        if (el) el.textContent = text;
    });
}

loadRecruitingNeeds();
</script>
{% endblock %}
